===============================================================================
Tag Creator: mlevy
Developers:  mlevy, jet, dbailey
Tag Date:    15 march 2016
Tag Name:    pop2/branch_tags/marbl_ciso_tags/marbl_ciso_n19_cesm_pop_2_1_20160314
Tag Summary: Merge latest trunk to branch, move PIO_VERSION=2 to default
             testmods_dir because many more tests don't build with pio1

M       ChangeLog
M       cime_config/testdefs/testmods_dirs/pop/ciso/shell_commands
M       cime_config/testdefs/testmods_dirs/pop/default/shell_commands
M       source/ice.F90
===============================================================================
Tag Creator: mlevy
Developers:  mlevy
Tag Date:    15 march 2016
Tag Name:    pop2/branch_tags/marbl_ciso_tags/marbl_ciso_n18_cesm_pop_2_1_20160307
Tag Summary: Bug fix: output autotroph_cnt correctly in marbl_ciso, output
             both autotroph_cnt and zooplankton_cnt in marbl_mod, and update
             testmods to use PIO_VERSION=2 in ciso tests.

M       cime_config/testdefs/testmods_dirs/pop/ciso/shell_commands
M       source/marbl_ciso_mod.F90
M       source/marbl_mod.F90
===============================================================================
Tag Creator: mlevy
Developers:  mlevy, klindsay
Tag Date:    11 march 2016
Tag Name:    pop2/branch_tags/marbl_ciso_tags/marbl_ciso_n17_cesm_pop_2_1_20160307
Tag Summary: Clean up calls to add_forcing_field for NOx_FLUX and NHy_FLUX,
             apply the scale factor in ecosys_driver (by way of the
             unit_conv_factor field in the single forcing field type)

             Start to trigger application of surface forcing fields on whether
             the index for that forcing is non-zero; eventually this should be
             the case for all forcings (not just nox_flux and nhy_flux).

M       source/ecosys_driver.F90
M       source/marbl_diagnostics_mod.F90
M       source/marbl_interface_types.F90
M       source/marbl_mod.F90
===============================================================================
Tag Creator: mlevy
Developers:  mlevy
Tag Date:    9 march 2016
Tag Name:    pop2/branch_tags/marbl_ciso_tags/marbl_ciso_n16_cesm_pop_2_1_20160307
Tag Summary: Update to newest trunk tag, kept branch code untouched because
             feature in 20160307 trunk tag was brought in with marbl_ciso_n14.

M       ChangeLog
===============================================================================
Tag Creator: mlevy
Developers:  mlevy
Tag Date:    9 march 2016
Tag Name:    pop2/branch_tags/marbl_ciso_tags/marbl_ciso_n15_cesm_pop_2_1_20160222
Tag Summary: Update to almost-newest trunk tag (latest trunk tag will conflict
             with branch, so I'll merge it separately); some nlcomp failures
             due to change in ecosys_restore but history files are bit-for-bit
             with the cesm_pop_2_1_20160222 tag (aux_pop_MARBL, yellowstone /
             intel)

M       ChangeLog
M       SVN_EXTERNAL_DIRECTORIES
M       bld/namelist_files/namelist_defaults_pop.xml
M       source/tidal_mixing.F90
M       source/vertical_mix.F90
M       source/vmix_kpp.F90
===============================================================================
Tag Creator: mlevy
Developers:  mvertens, mlevy
Tag Date:    8 march 2016
Tag Name:    pop2/branch_tags/marbl_ciso_tags/marbl_ciso_n14_cesm_pop_2_1_20160114
Tag Summary: dynamically allocate number of surface forcing fields, rather than
             using a parameter (num_surface_forcing_fields rather than
             max_surface_forcing_fields) - remove semantic content from surface
             forcing fields computation. aux_pop_MARBL is bit-for-bit w/
             marbl_ciso_n09 tag.

M       cime_config/testdefs/testlist_pop.xml
  - add SMS_Ld20.T62_g16.CECO.yellowstone_intel.pop-ecosys_shr_stream test to
    aux_pop_MARBL testlist

M       passive_tracer_tools.F90
	- minor formatting

M       marbl_interface_types.F90
	- initialized all of marbl_surface_forcing_indexing_type components to 0
	- introduced new marbl_saved_state_type that now contains both ph_prev_surf
	  and ph_prev_col  (also removed ph_input and ph_input_alt_co2 from marbl_forcing_indexing_type)
	- removed DATA from marbl_forcing_monthly_every_ts_type
	- made marbl_forcing_monthly_calendar_type public
	- removed conditional block "if (trim(field_source) .NE. "none") then" from marbl_single_forcing_field_init
	- added new case('constant') to marbl_single forcing_field_init

M       marbl_interface.F90
	- added marbl_saved_state_type and removed marbl_interior_forcing_saved_type
	- obtain number of surface forcing fields from call to init_surface_forcing_fields then add a statement to 
          allocate this%this%surface_input_forcings
	- moved call to marbl_ciso_set_interior_forcing and marbl_ciso_set_surface_forcing in the marbl_set_interior_forcing
	  and marbl_set_surface_forcing in marbl_mod
	- put in explicit keyword/value argument lists to all subroutine calls

M       marbl_share_mod.F90
	- removed use of marbl_surface_forcing_indexing_type
	- removed parameter settings of ndep_shr_stream_xxx and moved these to module variables in ecosys_driver

M       marbl_diagnostics_mod.F90
	- added saved_state as an argument to marbl_diagnostics_set_surface_forcing
	- bug fix for daigs(ind_diag%NHy_FLUX) from Mike Levy

M       marbl_mod.F90
	- removed a large number of module variables that are no longer needed at the module level
	- change to marbl_init_surface_forcing_fields to determine number of forcing fields at run time and
	  construct the forcing_fields data type accordingly
	- addition of new variables from 'driver' - surface_mask_id, d13c_id, d14c_id, d14c_gloavg_id
	- simplification of the calculation of ifrac_id (removal of fice_id)
	- call to marbl_ciso_set_interior_forcing from marbl_set_interior_forcing
	- call to marbl_ciso_set_surface_forcing from marbl_set_surface_forcing

M       marbl_sizes.F90
	- removal of parameter max_surface_forcing_fields and addition of variable num_surface_forcing_fields

M       ecosys_driver.F90
	- refactoring of ecosys_driver_set_input_forcing_data to have much
          less semantic content and leverage the new
	  surface_forcing_fields_data type
	- removal of dust_flux_in from ecosys_saved_state_type and introduction as a module variable
	- moved marbl_surface_forcing_fields as a member of marbl_instances
	- addition of shr_stream_var_cnt, shr_stream_no_ind,
	  shr_stream_nh_ind and strdata_inputlist(:) as module variables
	- removed argument of marbl_surface_forcing_fields from call to
  	  marbl_instances(iblock)%init
	- removed routine ecosys_driver_init_input_forcing_data (this code
  	  is now been incorporated into ecosys_driver_set_input_forcing_data at the first call

M       strdata_interface_mod.F90
        - changes needed for new shr_strdata functionality in ecosys_driver

===============================================================================
Tag Creator: mlevy
Developers:  mlevy
Tag Date:    1 Mar 2016
Tag Name:    pop2/branch_tags/marbl_ciso_tags/marbl_ciso_n13_cesm_pop_2_1_20160114
Tag Summary: Revert passive_tracers (bug introduced in marbl_ciso_n11)

M       source/passive_tracers.F90
===============================================================================
Tag Creator: mvertens
Developers:  mvertens
Tag Date:    29 Feb 2016
Tag Name:    pop2/branch_tags/marbl_ciso_tags/marbl_ciso_n12_cesm_pop_2_1_20160114
Tag Summary: renamed files in preparation for separation of marbl libraray
	
Renamed files:
	
D       ecosys_restore.F90
A       marbl_restore_mod.F90
	
D       ecosys_mod.F90
A       marbl_mod.F90
	
D       marbl_kinds.F90
A       marbl_kinds_mod.F90
	
D       marbl_share.F90
A       marbl_share_mod.F90
	
D       ecosys_diagnostics_mod.F90
A       marbl_diagnostics_mod.F90
	
Modifications needed for renamed files:
	
M       marbl_interface.F90
M       marbl_ciso_mod.F90
M       ecosys_driver.F90
M       moby_parms.F90
	
===============================================================================
Tag Creator: mvertens
Developers:  mvertens
Tag Date:    29 Feb 2016
Tag Name:    pop2/branch_tags/marbl_ciso_tags/marbl_ciso_n11_cesm_pop_2_1_20160114
Tag Summary: simplification to marbl interfaces 
	
M source/IRF_mod.F90
M source/abio_dic_dic14_mod.F90
M source/cfc11_mod.F90
M source/cfc_mod.F90
R source/co2calc.F90
M source/ecosys_diagnostics_mod.F90
M source/ecosys_driver.F90
M source/ecosys_mod.F90
M source/ecosys_tavg.F90
M source/horizontal_mix.F90
M source/iage_mod.F90
M source/ice.F90
M source/marbl_ciso_mod.F90
M source/marbl_co2calc_mod.F90
M source/marbl_interface.F90
M source/marbl_interface_types.F90
M source/marbl_internal_types.F90
M source/marbl_oxygen.F90
M source/marbl_schmidt_number_mod.F90
M source/marbl_share.F90
M source/moby_mod.F90
M source/passive_tracer_tools.F90
M source/passive_tracers.F90
M source/prognostic.F90

===============================================================================
Tag Creator: mlevy
Developers:  mlevy
Tag Date:    27 Feb 2016
Tag Name:    pop2/branch_tags/marbl_ciso_tags/marbl_ciso_n10_cesm_pop_2_1_20160114
Tag Summary: Bugfixes to build with NAG

M       source/ecosys_diagnostics_mod.F90
M       source/ecosys_mod.F90
M       source/ecosys_restore.F90
M       source/marbl_ciso_mod.F90
M       source/marbl_co2calc_mod.F90
===============================================================================
Tag Creator: mlevy
Developers:  mlevy
Tag Date:    26 Feb 2016
Tag Name:    pop2/branch_tags/marbl_ciso_tags/marbl_ciso_n09_cesm_pop_2_1_20160114
Tag Summary: Refactor ecosys_restore so that spatial dependency (reading
             fields for restoring) is pushed to the driver. Also removed the
             ability to restore using RTAU from a file; that functionality was
             not being tested, and can be added in later if desired.

M       bld/build-namelist
M       bld/namelist_files/namelist_definition_pop.xml
M       source/ecosys_driver.F90
M       source/ecosys_restore.F90
D       source/ecosys_restore_timescale_file.F90
D       source/ecosys_restore_timescale_interp.F90
M       source/marbl_interface.F90
M       source/marbl_interface_types.F90
===============================================================================
Tag Creator: mlevy
Developers:  mlevy
Tag Date:    16 Feb 2016
Tag Name:    pop2/branch_tags/marbl_ciso_tags/marbl_ciso_n08_cesm_pop_2_1_20160114
Tag Summary: Removing more POP dependencies - ref_pressure is now called from
             the driver and passed to ecosys_mod as part of
             marbl_interior_forcing_type; T0_Kelvin and rho_sw are now in
             marbl_constants_mod.F90 (along with several parameters that used
             to be in marbl_kinds.F90 -- c0, c1, c2, c1000, and p5). At this
             point, the only POP-dependencies remaining are in
             ecosys_retore.F90 and deal with reading the tracer fields used
             for restoring.

             aux_pop_MARBL test suite was bit-for-bit with marbl_diags_n40
             (and cesm2_1_20160114 trunk) on yellowstone_intel
	
M       source/ecosys_diagnostics_mod.F90
M       source/ecosys_driver.F90
M       source/ecosys_mod.F90
M       source/ecosys_restore.F90
M       source/ecosys_restore_timescale_interp.F90
M       source/marbl_co2calc_mod.F90
A       source/marbl_constants_mod.F90
M       source/marbl_interface_types.F90
M       source/marbl_kinds.F90
M       source/marbl_oxygen.F90
===============================================================================
Tag Creator: mvertens
Developers:  mvertens
Tag Date:    15 Feb 2016
Tag Name:    pop2/branch_tags/marbl_ciso_tags/marbl_ciso_n07_cesm_pop_2_1_20160114
Tag Summary: more steps in making marbl stand-alone and renaming of many variables
	     results are bfb 
	
M       source/passive_tracer_tools.F90
	- alias use statement forcing_monthly_every_ts => marbl_forcing_monthly_every_ts_type
	
M       source/marbl_interface_types.F90
	- added marbl_interior_forcing_saved_type (with elements ph_prev and ph_prev_alt_co2)
	- added marbl_surface_forcing_saved_type (with elements ph_prev and ph_prev_alt_co2)
	- renamed marbl_gcm_state_type => marbl_interior_forcing_type
	- renamed marbl_forcing_input_type => marbl_surface_forcing_input_type
	- renamed marbl_forcing_output_type => marbl_surface_forcing_output_type
	- renamed forcing_monthly_every_tys => marbl_forcing_monthly_every_ts_type
	- renamed stf_module => stf in marbl_surface_forcing_output_type
	- removed land_mask from marbl_domain_type
	- added fesedflux to marbl_interior_forcing_type
	- removed ph_prev and ph_prev_alt_co2 from marbl_surface_forcing_output_type
	
M       source/marbl_interface_constants.F90
	- just spacing
	
M       source/abio_dic_dic14_mod.F90
	- formatting to bring this into marbl in the near future
	
M       source/marbl_internal_types.F90
	- moved marbl_surface_forcing_indexing_type from marbl_share_mod to this file
	- renamed marbl_forcing_share_type => marbl_surface_forcing_share_type
	
M       source/marbl_interface.F90
	- significant changes to the input arguments of init,
	  set_interior_forcing and set_surface_forcing as well as to the changed names
	  mentioned above
	
M       source/ecosys_diagnostics_mod.F90
	- created a new subroutine marbl_diagnostics_set_interior_forcing that encapsulates
	  all the calls to store_diagnostics_xxx in marbl_set_interior. Now marbl_set_interior 
	  only calls marbl_diagnostics_set_interior_forcing.
	- moved all use statements of the form "use_diagnostics_xxx" from ecosys_mod.F90 to
	  ecosys_diagnostics_mod.F90
	
M       source/moby_mod.F90
	- removed use of co2calc (co2calc was not referenced)
	
M       source/marbl_share.F90
	- removed marbl_forcing_indexing_type (now in marby_interface_tyes)
	- removed ecsys_ind_xxx and ecosys_ciso_ind_xxx (now in marbl_sizes.F90)
	- renamed forcing_monthly_every_ts => marbl_forcing_monthly_every_ts
	
A       source/marbl_schmidt_number_mod.F90
M       source/schmidt_number.F90
	- moved schmidt_co2_surf from schmidt_numer.F90 to marbl_schmidt_number_mod.F90
	  this is needed for marbl to be built as a stand-alone library
	
M       source/ecosys_tavg.F90
	- renamed marbl_restore_diags => marbl_interior_restore_diags
	- renamed marbl_interior_diags => marbl_interior_forcing_diags
	- renamed marbl_forcing_diags => marbl_surface_forcing_diags

M       source/ecosys_mod.F90
M       source/marbl_ciso_mod.F90
	- implemented renaming mentioned above
	- removed use of store_diagnostics_xxx and removed the calls to store_diagnostics_xxx 
	  now only calling marbl_diagnostics_set_interior_forcing
	- pared down the arguments to marbl_setup_local_xxx
	- renamed STF_MODULE => stf
	- added keyword/value pairs to call to co2calc
	
D       source/co2calc_column.F90
A  +    source/marbl_co2calc_mod.F90
	- renamed col2calc_column marbl_co2calc_mod
	- ***removed #ifdef CCSM_COUPLED directives and added new routines
	  vmath_sqrt, vmath_exp and vmath_log ***
	  as a result marbl_co2calc_mod no longer depends on shr_vmath_mod
	  and only has CPP directives for NO_SHR_VMATH and CPRINTEL
	
M       source/marbl_sizes.F90
	- added max_prey_class_size and max_surface_forcing_fields
	
M       source/ecosys_driver.F90
	- significant changes to be consistent with above
	- only use the following interface types as module variables
	type(marbl_interface_class)     , dimension(max_blocks_clinic) :: marbl_instances
	type(marbl_diagnostics_type)    , dimension(max_blocks_clinic) :: marbl_interior_forcing_diags
	type(marbl_diagnostics_type)    , dimension(max_blocks_clinic) :: marbl_interior_restore_diags
	type(marbl_diagnostics_type)    , dimension(max_blocks_clinic) :: marbl_surface_forcing_diags
	type(marbl_forcing_fields_type) , dimension(max_blocks_clinic) :: marbl_surface_forcing_fields
	
M       source/prognostic.F90
	- removed use of marbl_share_mod
	
===============================================================================
Tag Creator: mlevy
Developers:  mlevy
Tag Date:    12 Feb 2016
Tag Name:    pop2/branch_tags/marbl_ciso_tags/marbl_ciso_n06_cesm_pop_2_1_20160114
Tag Summary: Merge marbl_logging branch back to marbl_ciso (this is
             marbl_logging_n13). More details:
             * replaced marbl_status_type with marbl_logging_type that
               contains both a status code (well, logical flag to indicate
               that the GCM should abort) and a text message to print to
               stdout
             * Updated a couple of ecosys_restore namelists and
               ecosys_ciso_nml to be read in from a string rather than pop_in
               (they were overlooked in conversion for ecosys_nml and
               ecosys_parms_nml)
             * Use this to log all output from initialization -- tracer
               indices, namelists (todo - currently only prints out namelist
               values that are read in from pop_in, need to print entire
               namelist instead), etc -- as well as some surface forcing /
               interior forcing messages. We no longer use stdout, my_task,
               master_task, or document from MARBL routines.
             The marbl_logging_type variable is part of the marbl_interface
             class (named StatusLog), and the ecosys_driver is responsible for
             printing the log to stdout / ocn.log as well as aborting if an
             error was reported.

M       source/co2calc_column.F90
M       source/ecosys_driver.F90
M       source/ecosys_mod.F90
M       source/ecosys_restore.F90
M       source/ecosys_restore_timescale_file.F90
M       source/ecosys_restore_timescale_interp.F90
M       source/marbl_ciso_mod.F90
M       source/marbl_interface.F90
M       source/marbl_interface_constants.F90
M       source/marbl_interface_types.F90
M       source/marbl_kinds.F90
A  +    source/marbl_logging.F90
M       source/marbl_parms.F90
===============================================================================
Tag Creator: jwolfe
Developers:  jwolfe
Tag Date:    10 Feb 2016
Tag Name:    pop2/branch_tags/marbl_ciso_tags/marbl_ciso_n05_cesm_pop_2_1_20160114
Tag Summary: Initial step to move to forcing_fields datatype

M       source/marbl_interface_types.F90
M       source/marbl_interface.F90
M       source/ecosys_diagnostics_mod.F90
M       source/marbl_parms.F90
M       source/ecosys_mod.F90
M       source/ecosys_driver.F90
===============================================================================
Tag Creator: mvertens
Developers:  mvertens
Tag Date:    07 Feb 2016
Tag Name:    pop2/branch_tags/marbl_ciso_tags/marbl_ciso_n04_cesm_pop_2_1_20160114
Tag Summary: next steps in making marbl stand-alone

Purpose of changes
------------------
- Make the number of maximum diagnostic fields run time rather than compile time
- Separate interface data types and internal marbl data types 
- Remove hard-coding of km in marbl interface and marbl internal types

Code reviews and testing
------------------------
Code reviewed by: mlevy, klindsay

Code testing: 

Answer changes
--------------
bfb

List all files eliminated:
--------------------------

ecosys_constants.F90 is now marbl_sizes.F90

List all files added and what they do: 
--------------------------------------

A       source/marbl_internal_types.F90
	- file contains marbl internal types that do not belong in 
   	  marbl_interface_types
        - moved the following from marbl_share_mod to marbl_internal_types
	    column_sinking_particle_type 
	    autotroph_type
            zooplankton_type
	    grazing_type

A       source/marbl_sizes.F90
	- specifies parameters sizes that are still set (at some point will
	want to make these allocatable) as well as a few other size variables
	that are determined at run time
	
List all existing files that have been modified, and describe the changes:
--------------------------------------------------------------------------

M        passive_tracer_tools.F90	
         - added forcing_monthly_every_ts (from marbl_interface_types) 
  	   as a public member function 
           this way other pop modules can directly use passive_tracer_tools as before

M        marbl_interface_types.F90
         - renamed marbl_column_domain_type  => marbl_domain_type
         - moved carbonate_type, autotroph_secondary_species_type, zooplankton_secondary_species_type, 
	   and dissolved_organic_matter_type to marbl_internal_types
         - *** added new constructors for derived type variables in both marbl_interface_types and
	   marbl_internal_types that previously depended on km as a parameter ***  

M        ecosys_restore.F90
         - ecosys_constants => marbl_sizes

M        marbl_interface.F90
	 - the following are now local variables in set_interior_forcing,
   	     marbl_interior_share(marbl_domain%km),
             marbl_zooplankton_share(zooplankton_cnt, marbl_domain%km)
             marbl_autotroph_share(autotroph_cnt, marbl_domain%km)
             marbl_particulate_share (note that contructor and destructor methods are now called for this)
	 - the following are now local variables in set_surface_forcing
             marbl_forcing_share (note that contructor and destructor methods are now called for this)

M        ecosys_diagnostics_mod.F90
         - put in two phases for initializing diagnostics - one to count the diagnostics and the second
           to allocate memory based on the count and initialize the diagnostics
         - as a result, removed the parameters max_interior_diags, max_forcing_diags and max_restore_diags
         
M        marbl_parms.F90
         - moved following from from marbl_share_mod.F90 to marbl_parms.F90
             autotrophs instance, autotroph_cnt, 
	     zoo_plankton instance and zoo_plankton_cnt
	     grazing_instance and grazer_prey_cnt    
         - removed usage of freq_opt_never, freq_opt_nmonth and freq_opt_nyear

M        moby_mod.F90, cfc_mod.F90, cfc11_mod.F90
         - reintroduce use of passive_tracer_tools instead of marbl_interfrace_types

M        marbl_share_mod.F90
         - removed use of mx_block, ny_block, km and max_blocks_clinic
         - put in use of marbl_sizes rather than ecosys_constants
	 - introduced new marbl parameters marbl_freq_opt_never, marbl_freq_opt_nyear and marbl_freq_opt_nmonth
         - removed definition of ALL derived types previously there and associated constructors
	     zooplankton_type, autotroph_type, grazing_type
             marbl_forcing_field_type, column_sinking_particle_type
             marbl_interior_share_type, marbl_particulate_share_type
 	     ecosys_surface_share_type (no longer needed)

M        ecosys_tavg
         - uses of marbl_share_mod and ecosys_constants modified to marbl_parms  
         - removal of max_interior_diags and max_forcing_diags
         - tavg_ids_interior, tavg_ids_restore and tavg_ids_forcing are now allocatable module variables rather
          than dimension by the above parameters 


M        passive_tracers.F90
         - removed use of ecosys_driver_tracer_cnt


M       ecosys_mod.F90
        - change of use statements to accomodate above changes
        - marbl_compute_photosynthetically_available_radiation => marbl_compute_PAR
        - PAR is now a module variable (of type marbl_PAR_type) and PAR%construct is called at beginning of 
          marbl_set_interior_forcing and PAR%destruct is called at the end of marbl_set_interior_forcing
        - routine init_forcing_monthly_every_ts => marbl_init_forcing_monthly_every_ts_metadata which is now a
          private module routine
        - other renaming consistency changes also implemented (e.g. marbl_ecocsys_ => marbl_)

M       marbl_ciso_mod.F90
        - change to use marbl_parms, marbl_interface_types and marbl_internal_types (see above)
        - seconds_in_year => marbl_seconds_in_year now set in marbl_share_mod

M       ecosys_driver.F90
        - changes to accomodate the above

M       prognostic.F90 
        - addition of max_forcing_fields 
